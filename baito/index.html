<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>出勤・退勤ログ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="wrap">
    <h1>出勤・退勤ログ</h1>
    <p class="sub">ワンタップ打刻（出勤→退勤） / 手入力 / 提出用TSV生成 / 検算 / CSV取り込み</p>
  </header>

  <main class="wrap">

    <!-- 会社登録 -->
    <section class="card">
      <h2>会社登録</h2>
      <div class="grid2">
        <label class="field">
          <span>会社名</span>
          <input id="companyName" type="text" placeholder="例：sandbox" />
        </label>

        <label class="field">
          <span>時給（円）</span>
          <input id="companyWage" type="number" inputmode="numeric" min="0" step="1" placeholder="例：1500" />
        </label>
      </div>

      <div class="row">
        <button id="addCompanyBtn" class="btn primary">会社を追加/更新</button>
        <button id="resetAllBtn" class="btn danger ghost">全データ削除</button>
      </div>

      <div class="row">
        <label class="field grow">
          <span>会社を選択</span>
          <select id="companySelect"></select>
        </label>
        <div class="pill" id="selectedWagePill">時給：-</div>
      </div>
      <p class="hint">※ 同名の会社は「時給を更新」扱いになります。</p>
    </section>

    <!-- ワンタップ打刻 -->
    <section class="card">
      <h2>ワンタップ打刻</h2>

      <div class="row">
        <button id="toggleClockBtn" class="btn primary big">出勤</button>
        <div class="pill" id="clockStatusPill">未出勤</div>
      </div>

      <p class="hint">
        ※ 会社を選んでから押してください。<br>
        1回目：出勤（開始時刻を自動記録） / 2回目：退勤（終了時刻を自動記録）
      </p>
    </section>

    <!-- 手入力：勤務追加 -->
    <section class="card">
      <h2>勤務を手入力で追加</h2>

      <div class="grid3">
        <label class="field">
          <span>日付</span>
          <input id="workDate" type="date" />
        </label>

        <label class="field">
          <span>出勤</span>
          <input id="startTime" type="time" />
        </label>

        <label class="field">
          <span>退勤</span>
          <input id="endTime" type="time" />
        </label>
      </div>

      <div class="grid2">
        <label class="field">
          <span>休憩（分）</span>
          <input id="breakMin" type="number" inputmode="numeric" min="0" step="1" value="0" />
        </label>

        <label class="field">
          <span>メモ（任意）</span>
          <input id="memo" type="text" placeholder="例：MTG/制作/投稿/研修など" />
        </label>
      </div>

      <div class="row">
        <button id="addShiftBtn" class="btn primary">勤務を追加</button>
        <button id="setTodayBtn" class="btn ghost">今日にする</button>
      </div>

      <p class="hint">※ 退勤が出勤より早い場合は「日またぎ（翌日退勤）」として計算します。</p>
    </section>

    <!-- 集計 -->
    <section class="card">
      <h2>集計</h2>

      <div class="stats">
        <div class="stat">
          <div class="label">今日（確定分のみ）</div>
          <div class="value" id="todaySummary">-</div>
        </div>
        <div class="stat">
          <div class="label">今月（確定分のみ）</div>
          <div class="value" id="monthSummary">-</div>
        </div>
        <div class="stat">
          <div class="label">選択会社（今月・確定分のみ）</div>
          <div class="value" id="companyMonthSummary">-</div>
        </div>
      </div>
    </section>

    <!-- 日付別一覧 -->
    <section class="card">
      <h2>その日の勤務一覧</h2>
      <div class="row">
        <label class="field grow">
          <span>表示する日付</span>
          <input id="listDate" type="date" />
        </label>
        <button id="copyDayBtn" class="btn ghost">この日の合計をコピー</button>
      </div>

      <div id="shiftList" class="list"></div>
      <div id="emptyState" class="empty">まだ勤務がありません。</div>
    </section>

    <!-- 提出用・検算・出力 -->
    <section class="card">
      <h2>提出用（見やすいコピペ） / 検算 / 出力</h2>

      <div class="grid2">
        <label class="field">
          <span>提出用の対象月（空なら全件）</span>
          <input id="reportMonth" type="month" />
        </label>
        <label class="field">
          <span>提出用の会社（空なら全部）</span>
          <input id="reportCompany" type="text" placeholder="例：sandbox（空なら全会社）" />
        </label>
      </div>

      <div class="row wrapRow">
        <button id="makeSubmitTsvBtn" class="btn primary">提出TSVを生成</button>
        <button id="makeSubmitMdBtn" class="btn ghost">提出Markdownを生成</button>
        <button id="makeAuditBtn" class="btn ghost">検算レポートを生成</button>
        <button id="exportCsvBtn" class="btn ghost">CSV出力（アプリ用）</button>
        <button id="exportJsonBtn" class="btn ghost">JSON出力</button>
        <button id="copyExportBtn" class="btn ghost">出力欄をコピー</button>
      </div>

      <textarea id="exportBox" class="export" placeholder="ここに出力されます（そのままコピペ提出OK）" readonly></textarea>

      <p class="hint">
        ✅ 提出TSV：Excel/スプレッドシートに貼ると列が分かれます。<br>
        ✅ 検算：勤務分・金額のズレがある行を検出します。
      </p>
    </section>

    <!-- CSV取り込み（貼り付け→反映） -->
    <section class="card">
      <h2>CSV取り込み（貼り付けて復元）</h2>
      <p class="hint">
        例：あなたが貼った形式（id,date,company,wage_yen,start,end,break_min,work_min,pay_yen,overnight,memo）をそのまま貼れます。
      </p>

      <textarea id="importBox" class="export" placeholder="ここにCSVを貼り付け"></textarea>
      <div class="row wrapRow">
        <button id="importCsvBtn" class="btn primary">取り込み（DBに反映）</button>
        <button id="dryRunImportBtn" class="btn ghost">取り込みテスト（反映なし）</button>
      </div>

      <div id="importResult" class="hint"></div>
    </section>

  </main>

  <footer class="wrap foot">
    <small>LocalStorage保存（ブラウザ/端末を変えるとデータは共有されません）。</small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
